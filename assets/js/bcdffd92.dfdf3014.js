"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[5206],{3905:(e,a,t)=>{t.d(a,{Zo:()=>c,kt:()=>f});var r=t(67294);function n(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function o(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);a&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,r)}return t}function l(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?o(Object(t),!0).forEach((function(a){n(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function i(e,a){if(null==e)return{};var t,r,n=function(e,a){if(null==e)return{};var t,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],a.indexOf(t)>=0||(n[t]=e[t]);return n}(e,a);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(n[t]=e[t])}return n}var s=r.createContext({}),d=function(e){var a=r.useContext(s),t=a;return e&&(t="function"==typeof e?e(a):l(l({},a),e)),t},c=function(e){var a=d(e.components);return r.createElement(s.Provider,{value:a},e.children)},y="mdxType",u={inlineCode:"code",wrapper:function(e){var a=e.children;return r.createElement(r.Fragment,{},a)}},p=r.forwardRef((function(e,a){var t=e.components,n=e.mdxType,o=e.originalType,s=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),y=d(t),p=n,f=y["".concat(s,".").concat(p)]||y[p]||u[p]||o;return t?r.createElement(f,l(l({ref:a},c),{},{components:t})):r.createElement(f,l({ref:a},c))}));function f(e,a){var t=arguments,n=a&&a.mdxType;if("string"==typeof e||n){var o=t.length,l=new Array(o);l[0]=p;var i={};for(var s in a)hasOwnProperty.call(a,s)&&(i[s]=a[s]);i.originalType=e,i[y]="string"==typeof e?e:n,l[1]=i;for(var d=2;d<o;d++)l[d]=t[d];return r.createElement.apply(null,l)}return r.createElement.apply(null,t)}p.displayName="MDXCreateElement"},26625:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>s,contentTitle:()=>l,default:()=>u,frontMatter:()=>o,metadata:()=>i,toc:()=>d});var r=t(87462),n=(t(67294),t(3905));const o={},l="Data Management",i={unversionedId:"tutorials/datastoring",id:"tutorials/datastoring",title:"Data Management",description:"Since storing data for your players is really a must-have in almost any game, we have provided for you one of the best data storing solutions out there. ProfileService! Our implementation of ProfileService is extremely easy to learn, and is way quicker to setup then the classic ways you would do it.",source:"@site/docs/tutorials/datastoring.md",sourceDirName:"tutorials",slug:"/tutorials/datastoring",permalink:"/CanaryEngine/docs/tutorials/datastoring",draft:!1,editUrl:"https://github.com/canary-development/CanaryEngine/edit/main/docs/tutorials/datastoring.md",tags:[],version:"current",frontMatter:{},sidebar:"CanaryEngineSidebar",previous:{title:"Networking",permalink:"/CanaryEngine/docs/tutorials/networking"},next:{title:"Style Guide",permalink:"/CanaryEngine/docs/tutorials/styleguide"}},s={},d=[{value:"Profile Stores",id:"profile-stores",level:3},{value:"Profiles",id:"profiles",level:3},{value:"Leaderstats",id:"leaderstats",level:3},{value:"Global Keys",id:"global-keys",level:3},{value:"Extras",id:"extras",level:3}],c={toc:d},y="wrapper";function u(e){let{components:a,...o}=e;return(0,n.kt)(y,(0,r.Z)({},c,o,{components:a,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"data-management"},"Data Management"),(0,n.kt)("p",null,"Since storing data for your players is really a must-have in almost any game, we have provided for you one of the best data storing solutions out there. ",(0,n.kt)("inlineCode",{parentName:"p"},"ProfileService"),"! Our implementation of ",(0,n.kt)("inlineCode",{parentName:"p"},"ProfileService")," is extremely easy to learn, and is way quicker to setup then the classic ways you would do it."),(0,n.kt)("h3",{id:"profile-stores"},"Profile Stores"),(0,n.kt)("p",null,"If you have ever used ProfileService before, you have probably heard of the ",(0,n.kt)("inlineCode",{parentName:"p"},"ProfileStore"),". It's basically just a ",(0,n.kt)("a",{parentName:"p",href:"https://create.roblox.com/docs/reference/engine/classes/GlobalDataStore"},"GlobalDataStore"),", but instead of managing keys, it manages individual profiles instead. These profiles are assigned to a unique ID, so they can be assigned to the player's ",(0,n.kt)("inlineCode",{parentName:"p"},"UserId"),", or it can be it's own thing. Though, first, lets create a new ",(0,n.kt)("inlineCode",{parentName:"p"},"ProfileStore")," using the ",(0,n.kt)("inlineCode",{parentName:"p"},"DataService.CreateProfileStore")," function:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-lua"},'local DataService = CanaryEngineServer.Data\nlocal MyNewDataStore = DataService.CreateProfileStore("MyProfileStore", {Cash = 100, Gems = 5, Items = {"Wooden Sword"}})\n')),(0,n.kt)("p",null,"After this, you can declare the key pattern if you want to. This is optional though, and the default is 'user_%d' for compatibility with older versions. Though, I recommend just changing to '%d', so it only contains the player's ",(0,n.kt)("inlineCode",{parentName:"p"},"UserId"),"."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-lua"},'local DataService = CanaryEngineServer.Data\nlocal MyNewDataStore = DataService.CreateProfileStore("MyProfileStore", {Cash = 100, Gems = 5, Items = {"Wooden Sword"}}, "%d") -- Change the pattern if you want to, it\'s better for usage\n')),(0,n.kt)("p",null,"Now, we can detect when the player joins, and when they do, we can load in their data by using ",(0,n.kt)("inlineCode",{parentName:"p"},"ProfileStoreObject:LoadProfileAsync"),". This will load in the profile and allow you to interact with the data. Here's how you would do that:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-lua"},'local DataService = CanaryEngineServer.Data\nlocal PlayerService = game:GetService("Players")\nlocal MyNewDataStore = DataService.CreateProfileStore("MyProfileStore", {Cash = 100, Gems = 5, Items = {"Wooden Sword"}}, "%d")\n\n-- // Functions\n\nlocal function PlayerAdded(player)\n    local PlayerProfile = MyNewDataStore:LoadProfileAsync(player) -- Load the profile, you can also add an optional `reconcile` argument which reconciles the data\nend\n\nPlayerService.PlayerAdded:Connect(PlayerAdded)\n')),(0,n.kt)("p",null,"Now sometimes, the player will join before the server script runs. To fix this, we can loop through all of the players after we listen to the player added event, then run the player added function:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-lua"},'local DataService = CanaryEngineServer.Data\nlocal PlayerService = game:GetService("Players")\nlocal MyNewDataStore = DataService.CreateProfileStore("MyProfileStore", {Cash = 100, Gems = 5, Items = {"Wooden Sword"}}, "%d")\n\n-- // Functions\n\nlocal function PlayerAdded(player)\n    local PlayerProfile = MyNewDataStore:LoadProfileAsync(player)\nend\n\nPlayerService.PlayerAdded:Connect(PlayerAdded)\n\nfor _, player in PlayerService:GetPlayers() do\n    task.spawn(PlayerAdded, player)\nend\n')),(0,n.kt)("p",null,"Now we are all set! But first, we have to make sure to unclaim the session lock when the player leaves. Doing this is pretty simple, just add this to your script:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-lua"},"PlayerService.PlayerRemoving:Connect(function(player)\n    MyNewDataStore:UnclaimSessionLock(player)\nend)\n")),(0,n.kt)("h3",{id:"profiles"},"Profiles"),(0,n.kt)("p",null,"Now we can get started on profiles. As explained in the introduction, profiles are essentially the successor to datastore keys. These are much easier to use and make the process of data saving so much easier. Setting the data here is as simple as editing a table. No getter or setter functions, you can make your own."),(0,n.kt)("p",null,"What we will do first is get the data we can edit from the profile. In order to do this, you must call ",(0,n.kt)("inlineCode",{parentName:"p"},"PlayerProfile:GetProfileData"),"."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-lua"},'local function PlayerAdded(player)\n    local PlayerProfile = MyNewDataStore:LoadProfileAsync(player)\n    local ProfileData = PlayerProfile:GetProfileData()\n\n    print(ProfileData) -- Output: {Cash = 100, Gems = 5, Items = {"Wooden Sword"}}\nend\n')),(0,n.kt)("p",null,"Now that we have verified that our code is indeed working, we can now edit the values in the profile data dictionary as so:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-lua"},'local function PlayerAdded(player)\n    local PlayerProfile = MyNewDataStore:LoadProfileAsync(player)\n    local ProfileData = PlayerProfile:GetProfileData()\n\n    print(ProfileData) -- Output: {Cash = 100, Gems = 5, Items = {"Wooden Sword"}}\n\n    table.insert(ProfileData.Items, "Iron Sword")\n\n    print(ProfileData) -- Output: {Cash = 100, Gems = 5, Items = {"Wooden Sword", "Iron Sword"}}\nend\n')),(0,n.kt)("p",null,"We can do quite a bit with this, such as increase the user's cash each time they join, or even remove specific items. When we join back, the iron sword should persist if you set up the profile store correctly. Though, there is one more thing you should learn: ",(0,n.kt)("inlineCode",{parentName:"p"},"GlobalKey"),"s."),(0,n.kt)("h3",{id:"leaderstats"},"Leaderstats"),(0,n.kt)("p",null,"When using EasyProfile, Roblox's player list ",(0,n.kt)("inlineCode",{parentName:"p"},"leaderstats")," are rather easy to setup. You only need to call 1 function. Here's an example of leaderstats being set up when the player joins:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-lua"},'local function PlayerAdded(player)\n    local PlayerProfile = MyNewDataStore:LoadProfileAsync(player)\n    local ProfileData = PlayerProfile:GetProfileData()\n\n    PlayerProfile:CreateProfileLeaderstats(player, {"Cash", "Gems"})\nend\n')),(0,n.kt)("p",null,"When they join, your leaderboard should look just like this: "),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"Player list example",src:t(47564).Z,width:"350",height:"95"})),(0,n.kt)("h3",{id:"global-keys"},"Global Keys"),(0,n.kt)("p",null,"Global keys are a better way of handling cross server communication with data, and you can even send data to offline ",(0,n.kt)("inlineCode",{parentName:"p"},"UserId"),"'s. It uses the Global Updates feature of ProfileService internally, and that system is very confusing which is why we made our own. There's really only 3 functions to learn, so it should be pretty straightforward to learn."),(0,n.kt)("p",null,"To start, we can create and setup our profile store just as how we did previously:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-lua"},'local DataService = CanaryEngineServer.Data\nlocal PlayerService = game:GetService("Players")\nlocal MyNewDataStore = DataService.CreateProfileStore("MyProfileStore", {Cash = 100, Gems = 5, Items = {"Wooden Sword"}}, "%d")\n\n-- // Functions\n\nlocal function PlayerAdded(player)\n    local PlayerProfile = MyNewDataStore:LoadProfileAsync(player)\nend\n\nPlayerService.PlayerRemoving:Connect(function(player)\n    MyNewDataStore:UnclaimSessionLock(player)\nend)\n\nPlayerService.PlayerAdded:Connect(PlayerAdded)\n\nfor _, player in PlayerService:GetPlayers() do\n    task.spawn(PlayerAdded, player)\nend\n')),(0,n.kt)("p",null,"First, in our ",(0,n.kt)("inlineCode",{parentName:"p"},"PlayerAdded")," function, lets send a new global key out to ourselves by using the ",(0,n.kt)("inlineCode",{parentName:"p"},"ProfileStoreObject:SetGlobalKeyAsync")," method:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-lua"},'local function PlayerAdded(player)\n    local PlayerProfile = MyNewDataStore:LoadProfileAsync(player)\n\n    MyNewDataStore:SetGlobalKeyAsync(player.UserId, "GlobalKeyTest", "somerandomstringdata") -- The first argument is the player who is recieving it, and the others are the key name followed by the value\nend\n')),(0,n.kt)("p",null,"To listen when the player recieves a new key in-game, you can use the ",(0,n.kt)("inlineCode",{parentName:"p"},"ProfileObject.GlobalKeyAdded")," event, it will fire when a new key is added:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-lua"},'local function PlayerAdded(player)\n    local PlayerProfile = MyNewDataStore:LoadProfileAsync(player)\n\n    PlayerProfile.GlobalKeyAdded:Connect(function(data)\n        print(data[1]) -- Output: {Key = "GlobalKeyTest", Value = {this = "is a test"}, KeyId = 1}\n    end)\n\n    MyNewDataStore:SetGlobalKeyAsync(player.UserId, "GlobalKeyTest", "somerandomstringdata")\nend\n')),(0,n.kt)("p",null,"Please note that when doing this, you must wait around 60 seconds for the key to be recieved. Though next, we should setup a way for us to recieve keys that we got when were offline. In order to do this, you can use the ",(0,n.kt)("inlineCode",{parentName:"p"},"ProfileObject:GetGlobalKeys")," method, it returns a table of global keys that we can loop through:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-lua"},'local function PlayerAdded(player)\n    local PlayerProfile = MyNewDataStore:LoadProfileAsync(player)\n\n    for _, globalKey in PlayerProfile:GetGlobalKeys() do\n        print(globalKey.Key, ":", globalKey.Value) -- Output: {Key = "GlobalKeyTest", Value = "somerandomstringdata", KeyId = 1}\n    end\n\n    PlayerProfile.GlobalKeyAdded:Connect(function(data)\n        print(data[1]) -- Output: {Key = "GlobalKeyTest", Value = "somerandomstringdata", KeyId = 2}\n    end)\n\n    MyNewDataStore:SetGlobalKeyAsync(player.UserId, "GlobalKeyTest", "somerandomstringdata")\nend\n')),(0,n.kt)("p",null,"Please do note that there is a difference between ",(0,n.kt)("inlineCode",{parentName:"p"},"GlobalKey"),"'s and regular keys. ",(0,n.kt)("inlineCode",{parentName:"p"},"GlobalKey"),"'s are supposed to be global: they can be recieved globally, and regular keys are just for the individual player that owns the profile."),(0,n.kt)("h3",{id:"extras"},"Extras"),(0,n.kt)("p",null,"There are a few extra functions you should know about. Here is a table of them: "),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:null},"Function"),(0,n.kt)("th",{parentName:"tr",align:null},"Description"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("inlineCode",{parentName:"td"},"ProfileObject:GetDataUsage")),(0,n.kt)("td",{parentName:"tr",align:null},"Allows you to measure the size of the profile's data, in a percentage (%)")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("inlineCode",{parentName:"td"},"ProfileObject:GetMetaData")),(0,n.kt)("td",{parentName:"tr",align:null},"Gets specific meta data about the profile, such as the amount of times it was loaded.")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("inlineCode",{parentName:"td"},"ProfileStoreObject:GetProfileAsync")),(0,n.kt)("td",{parentName:"tr",align:null},"Gets the profile data for a specific ",(0,n.kt)("inlineCode",{parentName:"td"},"UserId"),", useful for getting anyones data. You can not edit any values though.")))))}u.isMDXComponent=!0},47564:(e,a,t)=>{t.d(a,{Z:()=>r});const r=t.p+"assets/images/playerlist-example-3bc9c26a5be1ac87982c52ddea7ec7b6.png"}}]);